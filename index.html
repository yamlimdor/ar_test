<a-scene
    vr-mode-ui="enabled: false;"
    loading-screen="enabled: false;"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    renderer="antialias: true; alpha: true; precision: mediump; preserveDrawingBuffer: true;"
    id="scene"
    embedded
    gesture-detector
>
    <a-marker
        id="animated-marker"
        type="pattern"
        preset="custom"
        url="assets/marker.patt"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;"
        id="markerA"
    >
        <a-image
            src="assets/asset.png"
            scale="2 2 1"
            class="clickable"
            rotation="-90 0 0"
            position="0 1 0"
            gesture-handler
        ></a-image>
    </a-marker>

    <a-entity camera></a-entity>
</a-scene>

<button id="capture-button" 
        style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 100; font-size: 24px; padding: 15px 30px; border-radius: 50px; background-color: white; border: 2px solid #333; cursor: pointer; font-family: sans-serif; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
    📸 Take Photo
</button>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const captureButton = document.getElementById('capture-button');
        
        captureButton.addEventListener('click', () => {
            // A-Frameのcanvas要素を取得
            const scene = document.querySelector('a-scene');
            const canvas = scene.canvas;
            
            if (canvas) {
                // toBlob() を使用して、非同期で画像データを取得
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    
                    // ダウンロード用のリンクを作成
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'ar-photo.png';
                    
                    // リンクを一時的にDOMに追加してクリック
                    document.body.appendChild(a);
                    a.click();
                    
                    // 後片付け
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url); // URLを解放
                });
            }
        });
    });
</script>
