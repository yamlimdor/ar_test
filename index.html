<a-scene
    vr-mode-ui="enabled: false;"
    loading-screen="enabled: false;"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
    renderer="antialias: true; alpha: true; precision: mediump; preserveDrawingBuffer: true;"
    id="scene"
    embedded
    gesture-detector
>
    <a-marker
        id="animated-marker"
        type="pattern"
        preset="custom"
        url="assets/marker.patt"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;"
        id="markerA"
    >
        <a-image
            src="assets/asset.png"
            scale="2 2 1"
            class="clickable"
            rotation="-90 0 0"
            position="0 1 0"
            gesture-handler
        ></a-image>
    </a-marker>

    <a-entity camera></a-entity>
</a-scene>

<button id="capture-button" 
        style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 100; font-size: 24px; padding: 15px 30px; border-radius: 50px; background-color: white; border: 2px solid #333; cursor: pointer; font-family: sans-serif; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
    ğŸ“¸ Take Photo
</button>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const captureButton = document.getElementById('capture-button');
        
        captureButton.addEventListener('click', () => {
            // A-Frameã®canvasè¦ç´ ã‚’å–å¾—
            const scene = document.querySelector('a-scene');
            const canvas = scene.canvas;
            
            if (canvas) {
                // toBlob() ã‚’ä½¿ç”¨ã—ã¦ã€éåŒæœŸã§ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    
                    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ã®ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'ar-photo.png';
                    
                    // ãƒªãƒ³ã‚¯ã‚’ä¸€æ™‚çš„ã«DOMã«è¿½åŠ ã—ã¦ã‚¯ãƒªãƒƒã‚¯
                    document.body.appendChild(a);
                    a.click();
                    
                    // å¾Œç‰‡ä»˜ã‘
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url); // URLã‚’è§£æ”¾
                });
            }
        });
    });
</script>
